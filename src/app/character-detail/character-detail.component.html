<!--Modals for various actions liking taking damage and healing, maybe leveling up!-->
<div *ngIf="character">
  <!--Modify Health Modal-->
  <div class="modal" [class.showModal]="changeHP">
    <div class="modal-content small">
      <div class="modal-header">
        <span class="close" (click)="modHealth()">&times;</span>
        <h2>Modify Health</h2>
      </div>
      <div class="modal-body">
        <div class="body-head">
          Current HP:
          <span style="float:right; padding-right:5em; ">{{ character.health }}</span>
        </div>
        <select [(ngModel)]="type">
          <option value="-1">Take Damage</option>
          <option value="1">Regain Health</option>
        </select>
        <input type="number" [(ngModel)]="hpDmg" placeholder="{{ hpDmg }}" min="0" max="{{ character.maxHealth + 10 }}">
        <button class="square" (click)="modTheHMod(1)">+1</button>
        <button class="square" (click)="modTheHMod(5)">+5</button>
        <button class="square" (click)="modTheHMod(10)">+10</button>
        <div class="right">
          <button (click)="finalizeHealthMod()">Done</button>
        </div>
      </div>
    </div>
  </div>
  <!--Modify Magic Modal-->
  <div class="modal" [class.showModal]="changeMP">
    <div class="modal-content small">
      <div class="modal-header">
        <span class="close" (click)="modMagic()">&times;</span>
        <h2>Modify Magic</h2>
      </div>
      <div class="modal-body">
        <div class="body-head">
          Current MP:
          <span style="float:right; padding-right:5em; ">{{ character.magic }}</span>
        </div>
        <select [(ngModel)]="type">
          <option value="1">Restore Magic</option>
          <option value="-1">Cast Magic</option>
        </select>
        <input type="number" min="0" [(ngModel)]="mpDmg" placeholder="{{ mpDmg }}" max="{{ character.maxMagic }}">
        <button class="square" (click)="modTheMMod(1)">+1</button>
        <button class="square" (click)="modTheMMod(5)">+5</button>
        <button class="square" (click)="modTheMMod(10)">+10</button>
        <div class="right">
          <button (click)="finalizeMagicMod()">Done</button>
        </div>
      </div>
    </div>
  </div>
  <!--Level Up Modal-->
  <div class="modal" [class.showModal]="editMode">
    <div class="modal-content">
      <div class="modal-header">
        <span class="close" (click)="setEdit()">&times;</span>
        <h2>Level Up</h2>
      </div>
      <app-character-level-up [currChar]="character" #levelUp></app-character-level-up>
    </div>
  </div>
</div>
<!--The rest of the application the shows the characters attributes and skills-->
<div class="column-holder">
  <div *ngIf="character">
    <!--The table to show the characters attributes and the ability to roll dice with modifiers-->
    <div class="details">

      <button style="margin-bottom:1em;" (click)="setEdit()">Level Up</button>

      <button class="accordian" (click)="expandDets()">
        <h2>{{ character.name | uppercase }} Details</h2>
      </button>
      <div class="panel" [class.active]="showDets">
        <div class="attributes">
          <div class="table">
            <table>
              <thead>
                <tr>
                  <th>Trait</th>
                  <th>Value/Score</th>
                  <th>Modifier</th>
                </tr>
              </thead>
              <br/>
              <tbody>
                <tr>
                  <td class="name">Name</td>
                  <td>{{ character.name }}</td>
                </tr>
                <tr>
                  <td class="name">Race</td>
                  <td>{{ character.race }}</td>
                </tr>
                <tr [hidden]="!character.subRace">
                  <td class="name">Sub Race</td>
                  <td>{{ character.subRace }}</td>
                </tr>
                <br/>
                <tr *ngFor="let attr of character.attributes" [class.din]="attr.name === 'Strength' || attr.name === 'Intelligence'" [class.farore]="attr.name === 'Dexterity' || attr.name === 'Charisma'"
                  [class.nayru]="attr.name === 'Wisdom' || attr.name === 'Constitution'">
                  <td class="name">{{ attr.name }}</td>
                  <td>{{ attr.value }}</td>
                  <td>{{ attr.modifier }}</td>
                </tr>
                <br/>
                <tr></tr>
                <tr class="din">
                  <td class="name">Health</td>
                  <td>{{ character.health }} / {{ character.maxHealth }}</td>
                  <td>
                    <button (click)="modHealth()">Modify HP</button>
                  </td>
                </tr>
                <tr class="nayru">
                  <td class="name">Magic</td>
                  <td>{{ character.magic }} / {{ character.maxMagic }}</td>
                  <td>
                    <button (click)="modMagic()">Modify MP</button>
                  </td>
                </tr>
                <tr class="farore">
                  <td class="name">Experience</td>
                  <td>{{ character.exp }}</td>
                  <td></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <br/>

      <h3> Roll Dice
        <span style="float: right; padding-right:5em;" *ngIf="roll" [class.crit]="this.crit" [class.critmiss]="this.critmiss" [class.maxDmg]="this.maxDmg">
          {{ roll }}
        </span>
      </h3>

      <h4> Add a modifier to your roll.</h4>
      <select [(ngModel)]="rollMod">
        <option value="null" selected="selected">None</option>
        <option *ngFor="let attr of character.attributes" [value]="attr.name">{{ attr.name }}</option>
      </select>
      <br>
      <br>
      <app-die [sides]="4" [character]="this" [mod]="rollMod"></app-die>
      <app-die [sides]="6" [character]="this" [mod]="rollMod"></app-die>
      <app-die [sides]="8" [character]="this" [mod]="rollMod"></app-die>
      <app-die [sides]="12" [character]="this" [mod]="rollMod"></app-die>
      <app-die [sides]="20" [character]="this" [mod]="rollMod"></app-die>
      <app-die [sides]="100" [character]="this"></app-die>


    </div>
    <!--The table to show the character's skills (weapon, magic and normal)-->
    <div class="skills scrollable">
      <button class="accordian" (click)="expandSkill()">
        <h2>{{ character.name | uppercase }} Skills</h2>
      </button>
      <div class="panel" [class.active]="showSkills">
        <div class="table">
          <table>
            <thead>
              <tr>
                <th>Trained</th>
                <th>Skill Name</th>
                <th>Skill Ranks</th>
                <th>Racial Bonus</th>
                <th>Modifier</th>
                <th>Item Bonus</th>
                <th>Misc. Ranks</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let skill of character.skills" [class.din]="skill.modifier === 'Strength' || skill.modifier === 'Intelligence'"
                [class.farore]="skill.modifier === 'Dexterity' || skill.modifier === 'Charisma'" [class.nayru]="skill.modifier === 'Wisdom' || skill.modifier === 'Constitution'">
                <td>
                  <input type="checkbox" [checked]="skill.trained" disabled="true" />
                </td>
                <td class="name">
                  <div *ngIf="skill.skillName==='Craft 1' || skill.skillName==='Craft 2' || skill.skillName==='Profession' || skill.skillName==='Perform'; then specialSkill; else normalSkill"></div>

                  <ng-template #specialSkill>
                    <div *ngIf="skill.skillName==='Craft 1'">
                      {{ skill.skillName.substr(0, skill.skillName.length-2) + ' (' + (character.craftOne ? character.craftOne : 'Other') +')'}}
                    </div>
                    <div *ngIf="skill.skillName==='Craft 2'">
                      {{ skill.skillName.substr(0, skill.skillName.length-2) + ' (' + (character.craftTwo ? character.craftTwo : 'Other') +')'}}
                    </div>
                    <div *ngIf="skill.skillName==='Profession'">
                      {{ skill.skillName + ' (' + (character.profession ? character.profession : 'Other') +')'}}
                    </div>
                    <div *ngIf="skill.skillName==='Perform'">
                      {{ skill.skillName + ' (' + (character.performCust ? character.performCust : 'Other') +')'}}
                    </div>
                  </ng-template>
                  <ng-template #normalSkill>
                    {{ skill.skillName }}
                  </ng-template>
                </td>
                <td>{{ skill.ranks }}</td>
                <td>{{ skill.racial }}</td>
                <td class="mod">{{ skill.modifier.substr(0,3) | uppercase }}
                  <span class="info">{{ getMod(skill.modifier) }}</span>
                </td>
                <td>{{ skill.item }}</td>
                <td>{{ skill.misc }}</td>
                <td class="total">{{ (skill.trained ? 3 : 0) + skill.ranks + getMod(skill.modifier) + skill.item + skill.misc + skill.racial}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <button class="accordian" (click)="expandWeapon()">
        <h2>{{ character.name | uppercase }} Weapon Skills</h2>
      </button>
      <div class="panel" [class.active]="showWeapon">
        <div class="table">
          <table>
            <thead>
              <tr>
                <th>Trained</th>
                <th>Weapon Type</th>
                <th>Skill Ranks</th>
                <th>Racial Bonus</th>
                <th>Total
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let weapon of character.weaponSkills" class="weapon">
                <td>
                  <input type="checkbox" [checked]="weapon.trained" disabled="true" />
                </td>
                <td class="name">{{ weapon.skillName }}</td>
                <td>{{ weapon.ranks }}</td>
                <td>{{ weapon.racial }}</td>
                <td class="total">{{ (weapon.trained ? 3 : 0) + weapon.ranks + weapon.racial }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <button class="accordian" (click)="expandMagic()">
        <h2>{{ character.name | uppercase }} Magic Skills</h2>
      </button>
      <div class="panel" [class.active]="showMagic">
        <div class="table">
          <table>
            <thead>
              <tr>
                <th>Magic Type</th>
                <th>Modifier</th>
                <th>Skill Ranks</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let magic of character.magicSkills" [class.din]="magic.modifier === 'Intelligence'" [class.farore]="magic.modifier === 'Charisma'"
                [class.nayru]="magic.modifier === 'Wisdom'">
                <td class="name">{{ magic.skillName }}</td>
                <td class="mod">{{ magic.modifier.substr(0,3) | uppercase }}
                  <span class="info">{{ getMod(magic.modifier)}}</span>
                </td>
                <td>{{ magic.ranks }}</td>
                <td class="total">{{ magic.ranks+getMod(magic.modifier) }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- <h2>{{ character.name | uppercase }} Skills</h2>
        <div class="table">
          <table>
            <thead>
              <tr>
                <th>Trained</th>
                <th>Skill Name</th>
                <th>Skill Ranks</th>
                <th>Racial Bonus</th>
                <th>Modifier</th>
                <th>Item Bonus</th>
                <th>Misc. Ranks</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let skill of character.skills">
                <td>
                  <input type="checkbox" [checked]="skill.trained" disabled="true" />
                </td>
                <td class="name">
                  <div *ngIf="skill.skillName==='Craft 1' || skill.skillName==='Craft 2' || skill.skillName==='Profession' || skill.skillName==='Perform'; then specialSkill; else normalSkill"></div>

                  <ng-template #specialSkill>
                    <div *ngIf="skill.skillName==='Craft 1'">
                      {{ skill.skillName.substr(0, skill.skillName.length-1)}}
                      <input class="skill" type="text" [(ngModel)]="character.craftOne" placeholder="Craft One">
                    </div>
                    <div *ngIf="skill.skillName==='Craft 2'">
                      {{ skill.skillName.substr(0, skill.skillName.length-1)}}
                      <input class="skill" type="text" [(ngModel)]="character.craftTwo" placeholder="Craft Two">
                    </div>
                    <div *ngIf="skill.skillName==='Profession'">
                      {{ skill.skillName }}
                      <input class="skill" type="text" [(ngModel)]="character.profession" placeholder="Profession">
                    </div>
                    <div *ngIf="skill.skillName==='Perform'">
                      {{ skill.skillName }}
                      <input class="skill" type="text" [(ngModel)]="character.performCust" placeholder="(Other)">
                    </div>
                  </ng-template>
                  <ng-template #normalSkill>
                    {{ skill.skillName }}
                  </ng-template>
                </td>
                <td>
                  <input type="number" [(ngModel)]="skill.ranks">
                </td>
                <td>{{ skill.racial }}</td>
                <td class="mod">{{ skill.modifier.substr(0,3) | uppercase }}
                  <span class="info">{{ getMod(skill.modifier) }}</span>
                </td>
                <td>
                  <input type="number" [(ngModel)]="skill.item">
                </td>
                <td>
                  <input type="number" [(ngModel)]="skill.misc">
                </td>
                <td>{{ (skill.trained ? 3 : 0) + skill.ranks + getMod(skill.modifier) + skill.item + skill.misc + skill.racial}}</td>
              </tr>
            </tbody>
          </table>
        </div>
        <h2>{{ character.name | uppercase }} Weapon Skills </h2>
        <div class="table">
          <table>
            <thead>
              <tr>
                <th>Trained</th>
                <th>Weapon Type</th>
                <th>Skill Ranks</th>
                <th>Racial Bonus</th>
                <th>Total
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let weapon of character.weaponSkills">
                <td>
                  <input type="checkbox" [checked]="weapon.trained" disabled="true" />
                </td>
                <td class="name">{{ weapon.skillName }}</td>
                <td>
                  <input type="number" [(ngModel)]="weapon.ranks">
                </td>
                <td>{{ weapon.racial }}</td>
                <td>{{ (weapon.trained ? 3 : 0) + weapon.ranks + weapon.racial }}</td>
              </tr>
            </tbody>
          </table>
        </div>
        <h2>{{ character.name | uppercase }} Magic Skills </h2>
        <div class="table">
          <table>
            <thead>
              <tr>
                <th>Magic Type</th>
                <th>Modifier</th>
                <th>Skill Ranks</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let magic of character.magicSkills">
                <td class="name">{{ magic.skillName }}</td>
                <td class="mod">{{ magic.modifier.substr(0,3) | uppercase }}
                  <span class="info">{{ getMod(magic.modifier)}}</span>
                </td>
                <td>
                  <input type="number" [(ngModel)]="magic.ranks">
                </td>
                <td>{{ magic.ranks+getMod(magic.modifier) }}</td>
              </tr>
            </tbody>
          </table>
        </div> -->
    </div>

  </div>
</div>